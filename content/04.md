#基于DNS的负载均衡
基于DNS的负载均衡是负载均衡中最简单的形式。即便如此，它非常强大。它可以用来非常快速地解决诸多性能问题，因为它允许你将用户发来的请求转发到服务器群中的任意一台服务器上。

##BIND(Berkley Internet Naming Daemon)
世界上用得最多的DNS服务器软件大概是BIND。安装好了BIND，需要对它进行配置。BIND配置是出了名的复杂；虽然配置很复杂，但并未在正常人的能力之外。首先到/etc/bind目录下查看文件列表。你可以看到有若干文件，但对你来讲，实际上只用关心其中的一部分：

- bind.keys
- db.0
- db.127
- db.255
- db.empty
- db.local
- db.root
- named.conf
- named.conf.default-zones
- named.conf.local
- named.conf.options
- rndc.key
- zones.rfs1918

这个文件列表显示了标准配置文件以及一些db文件。这些db文件是BIND的关键部分，它们是DNS关键记录数据库。在配置DNS服务器时，你可以创建自己的DNS数据库。每个DNS数据库有两个分离的部分，其中第一部分是头：

```txt
$TTL 604800
@	IN	SOA	ns1.example.com. info.example.com. (
				2011102401	; Serial
				      7200  ; Refresh
					   900  ; Retry
			       2419200	; Expire
					604800)	; Min
;
```

BIND数据库的第一部分是TTL标记。实际上，有效时间设置跟它的用途一样。604800代表一周的时间，这意味着服务器会将这些信息在自身名称服务器信息缓存中保留一周的时间。

之后是`@ IN SOA ns1.example.com. info.example.com.`。这行代表你所管理的域，意思是：域@（通配符指本地托管的这个域）在这里；这是域的起始授权机构（SOA）服务器，并被当做`ns1.example.com`；你可以通过`info@example.com`联系到管理员。

###DNS DB的头
第一部分是为大家所喜欢的序列号。序列号是DNS数据库中起版本跟踪作用的唯一标识。它提供了单个字段记录，以供其他服务器判定是否有更新，以及它们是否要完全更新它们数据库中有关你的服务器的记录。每当更改了DNS的db文件，你都必须更新这个序列号，这点必须强调。

（1）刷新时间

刷新时间代表再次向这台服务器进行查询前，服务器所需要等待的时间总量。推荐值为1200到43200之间，也就是30分钟到12小时之间。

（2）重试时间

紧接着是重试时间。这个值代表如果在进行更新时这台服务器不可用，其他服务器重试连接这台服务器的频率。标准值的区间是120~900，代表2~15分钟。

（3）有效时间

在重试时间之后就是有效时间。它决定了这个记录在再次被查询之前，应该在其他服务器中保持有效状态多久。有效时间值意味着，如果刷新DNS数据的请求已经发出，而这个域的名称服务器宕机了，那么当前DNS信息会从上次刷新时间算起，直到过期时间为止，都保持有效。

（4）解析失败缓存最小时间

最后一个值是解析失败缓存最小时间。它是解析失败信息缓存的时长。


###DNS数据库记录
DNS数据库记录包含如下内容：

- 你所提供的该记录地址名称；
- 关键字IN；
- 记录的类型；
- 该记录的值。

```txt
@	IN NS ns1.example.com.
@	IN NS ns2.example.com.

example.com.	IN MX 10 mail.example.com.

example.com.	IN A 123.123.123.123
mail	IN A 123.123.123.123
ns1	IN A 234.234.234.234
ns2	IN A 234.234.234.234

www	IN CNAME example.com.
ftp	IN CNAME example.com.
```

这里有4种类型的DNS记录示例：NS记录代表名称服务器记录；MX记录代表邮件收发器记录；A记录将一个IP地址和一个域名链接起来；CNAME记录代表规范名称或是别名。

- **名称服务器** 两个名称服务器都有“@”符号。它们是自引用元素，说明这台服务器既是ns1.example.com，又是ns2.example.com。它们允许你公开提供这些名称服务器的名称。另外，这台服务器为此域的授权机构，地址也和上游服务器关联了起来。
- **邮件收发器** 注意看邮件收发器记录中的数字值。这是MX记录中多出的一个字段，称为pref，它是对名称服务器的性能和负载均衡的简单度量。这个值说明了对特定邮件服务器的偏好度。
- **A记录** 紧接着是A记录。它们跟DNS的设置紧密关联，代表着在同一个域的头下面的所有域名。
- **规范名称** 最后一类记录是规范名称。CNAME记录和A记录一样，可提供一个名称，但后面跟的不是IP地址，而是另外一个名称。


###加载数据库
在正确地写好DB文件后，你需要告诉BIND来加载这个文件。这个配置文件在`/etc/bind/named.conf.default-zones`中，被称为区域文件。这个文件有一个条目列表，可供你添加多个DNS数据库，这样你实际上就可以在一个DNS服务器上托管多个域了。

```txt
zone "." {
	type hint;
	file "/etc/bind/db.root";
};

zone "localhost" {
	type master;
	file "/etc/bind/db.local";
};

zone "example.com" {
	type master;
	file "/etc/bind/db.example.com";
};
```

写好了配置文件后，可以用`named-checkzone`来进行检查。调用格式为`named-checkzone <Domain> <DB File>`。

##基于DNS的负载均衡
对于实际的负载均衡，它的工作机制非常简答。它使用一种称为轮转的方式，来向特定域的一组服务器分发连接请求。

###优势
- 简便
- 配置简单
- 易于调试
- 容易扩展


###问题
- 粘性
- 负载处理方式
- 容错性